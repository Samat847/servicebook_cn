# Руководство по тестированию ServiceBook

## Тестирование сохранения автомобилей (Priority 1)

Это самый важный тест для проверки корректности работы приложения.

### Сценарий 1: Добавление и перезапуск

1. **Запустите приложение**
   ```bash
   flutter run
   ```

2. **Добавьте первый автомобиль**
   - Перейдите на вкладку "Профиль" (или "Авто")
   - Нажмите "Добавить автомобиль"
   - Заполните поля:
     - Марка: Chery
     - Модель: Tiggo 4
     - Год: 2023
     - Госномер: А123БВ777
     - Пробег: 15000
   - Нажмите "Добавить автомобиль"

3. **Проверьте логи**
   В консоли должны появиться сообщения:
   ```
   [CarStorage] Car saved: Chery Tiggo 4 (Total: 1)
   ```

4. **Перезапустите приложение**
   - В терминале нажмите `r` для горячей перезагрузки
   - Или остановите приложение и запустите снова

5. **Проверьте наличие автомобиля**
   - Автомобиль должен отображаться в списке
   - В логах должно быть:
   ```
   [CarStorage] Loaded 1 cars
   ```

### Сценарий 2: Несколько автомобилей

1. **Добавьте ещё один автомобиль**
   - Марка: Geely
   - Модель: Coolray
   - Год: 2024
   - Госномер: В456ДЕ799

2. **Проверьте логи**
   ```
   [CarStorage] Car saved: Geely Coolray (Total: 2)
   ```

3. **Перезапустите приложение**

4. **Проверьте**
   - Должны отображаться 2 автомобиля
   - Лог: `[CarStorage] Loaded 2 cars`

### Сценарий 3: Удаление автомобиля

1. **Удалите один автомобиль**
   - Смахните карточку автомобиля влево
   - Подтвердите удаление

2. **Перезапустите приложение**

3. **Проверьте**
   - Удалённый автомобиль не должен отображаться
   - Должен остаться только один автомобиль

## Тестирование настроек профиля (Priority 2)

### Сценарий: Редактирование профиля

1. **Откройте профиль**
   - Профиль → Личные данные

2. **Заполните поля**
   - Имя: Иван Иванов
   - Email: ivan@example.com
   - Телефон: +79991234567
   - Город: Москва

3. **Нажмите "Сохранить"**

4. **Проверьте**
   - Должно появиться сообщение "Профиль сохранен"
   - Данные должны обновиться на экране профиля

5. **Перезапустите приложение**

6. **Проверьте**
   - Имя и город должны сохраниться
   - Email и телефон должны отображаться

### Сценарий: Переключение языка

1. **Откройте настройки языка**
   - Профиль → Настройки → Язык

2. **Выберите English**
   - Нажмите на "English"
   - Подтвердите выбор

3. **Проверьте**
   - Интерфейс должен частично перевестись
   - Сообщение: "Language changed to English"

4. **Перезапустите приложение**

5. **Проверьте**
   - Язык должен сохраниться
   - Интерфейс на английском

## Тестирование фото в записях (Priority 3)

### Сценарий: Добавление фото к записи о расходе

1. **Добавьте запись**
   - Главная → Добавить запись
   - Заполните обязательные поля:
     - Название: Топливо
     - Дата: сегодняшняя
     - Пробег: 15050
     - Сумма: 3000
     - Категория: Топливо
   - (Требует реализации UI для фото)

2. **Примечание:**
   - Фото уже поддерживаются в модели Expense
   - UI для добавления фото ещё не реализован в add_service_screen.dart
   - Это требует дополнительной разработки

## Тестирование уведомлений (Priority 3)

### Сценарий: Планирование напоминания

1. **Откройте детали автомобиля**
   - Профиль → Выберите автомобиль

2. **Добавьте запись о ТО**
   - Дата: через 10 дней от сегодня
   - Категория: Обслуживание

3. **Проверьте**
   - Лог: `[NotificationService] Initialized`
   - Лог: `[NotificationService] Scheduled service reminder for [имя авто]`

4. **Дождитесь уведомления**
   - Через 7 дней должно прийти уведомление
   - Или проверьте отложенные уведомления

### Как проверить отложенные уведомления (требует реализации UI):

В консоли можно добавить код для проверки:
```dart
final pending = await NotificationService.getPendingNotifications();
print('Pending notifications: $pending');
```

## Тестирование экспорта/импорта (Priority 2)

### Сценарий: Экспорт в JSON

1. **Откройте управление данными**
   - Профиль → Настройки → Управление данными

2. **Экспортируйте данные**
   - Нажмите "Экспортировать данные"
   - Выберите "JSON"

3. **Проверьте**
   - Должен открыться диалог "Поделиться"
   - Можно отправить файл через:
     - Telegram
     - Email
     - Сохранить в Google Drive

### Сценарий: Импорт из JSON

1. **Удалите несколько автомобилей**
   - Для тестирования импорта

2. **Импортируйте данные**
   - Управление данными → Импортировать данные
   - Выберите JSON-файл
   - Подтвердите импорт

3. **Проверьте**
   - Все автомобили должны восстановиться
   - Записи должны появиться
   - Документы должны восстановиться

## Тестирование PDF-отчётов (Priority 3)

### Сценарий: Генерация PDF

1. **Откройте управление данными**

2. **Экспортируйте в PDF**
   - Нажмите "Экспортировать данные"
   - Выберите "PDF"

3. **Проверьте**
   - Должен открыться диалог "Поделиться"
   - Можно отправить PDF по email
   - Или просмотреть в PDF-просмотрщике

## Проверка логов

### Где смотреть логи

1. **В терминале при запуске flutter run**
   - Все debugPrint сообщения отображаются здесь

2. **Ключевые сообщения**
   ```
   [CarStorage] Car saved: [имя авто] (Total: [количество])
   [CarStorage] Loaded [количество] cars
   [NotificationService] Initialized
   [NotificationService] Scheduled service reminder for [имя авто]
   [PhotoService] Photo saved: [путь]
   [PhotoService] Photo deleted: [путь]
   ```

### Если логи не появляются

Проверьте:
- Flutter запущен в режиме debug
- Приложение не перезапущено в release режиме
- Нет ошибок в консоли

## Автоматическое тестирование

### Запуск unit-тестов

```bash
flutter test
```

### Запуск widget-тестов

```bash
flutter test test/widget_test.dart
```

### Запуск интеграционных тестов (Playwright)

```bash
# Запуск дев-сервера
flutter run

# В другом терминале
playwright-cli
```

## Частые проблемы и решения

### Проблема: Автомобили не сохраняются

**Возможные причины:**
1. Приложение работает в неправильном режиме
2. Ошибка при сохранении в SharedPreferences
3. Приложение закрылось до завершения сохранения

**Решения:**
1. Проверьте логи на наличие ошибок
2. Убедитесь, что приложение запущено в debug-режиме
3. Подождите полного завершения операции перед закрытием

### Проблема: Фото не сохраняются

**Возможные причины:**
1. Нет разрешений на доступ к галерее/камере
2. Недостаточно места на устройстве
3. Путь к фото некорректный

**Решения:**
1. Проверьте разрешения в настройках приложения
2. Освободите место на устройстве
3. Проверьте логи PhotoService

### Проблема: Уведомления не приходят

**Возможные причины:**
1. Уведомления отключены в настройках
2. Приложение не имеет разрешений
3. Уведомления запланированы на прошедшую дату

**Решения:**
1. Включите уведомления в настройках
2. Выдайте разрешение на уведомления
3. Проверьте дату планирования уведомления

## Отчёт о тестировании

После завершения тестирования заполните шаблон:

```
Дата тестирования: ___________
Версия приложения: ___________
Устройство: ___________
Android версия: ___________

### Результаты:

1. Сохранение автомобилей: [ ] Пройдено / [ ] Не пройдено
   - Примечания: ___________

2. Редактирование профиля: [ ] Пройдено / [ ] Не пройдено
   - Примечания: ___________

3. Переключение языка: [ ] Пройдено / [ ] Не пройдено
   - Примечания: ___________

4. Экспорт в JSON: [ ] Пройдено / [ ] Не пройдено
   - Примечания: ___________

5. Импорт из JSON: [ ] Пройдено / [ ] Не пройдено
   - Примечания: ___________

6. Экспорт в PDF: [ ] Пройдено / [ ] Не пройдено
   - Примечания: ___________

7. Уведомления: [ ] Пройдено / [ ] Не пройдено
   - Примечания: ___________

### Общие замечания:
_________________________
_________________________
_________________________
```

---

**Версия:** 1.0.0
**Дата:** Февраль 2025
